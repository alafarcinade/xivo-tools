** Fonctionnement de la HA avec l'IP virtuelle **
=================================================

La HA fonctionne sur le principe suivant: un XiVO joue le rôle de "maître". Il est le XiVO principal qui tourne en
permanence. Un deuxième XiVO joue le rôle d'"esclave". Sur cet esclave, les services XiVO sont arrêtés tant que le
maître est fonctionnel. L'esclave ping le maître à intervalles réguliers. S'il ne parvient pas à le joindre, il prend le
relai en démarrant ses services XiVO.

D'autre part, le maître recopie toutes les heures sa base de données (asterisk, dans postgres) sur l'esclave.


Lorsque l'IP virtuelle est installée, le principe de fonctionnement est semblable mais un peu plus complexe.

* Rôle du maître *
------------------

1) monter l'IP virtuelle (VOIP et DATA) dès que possible, c'est-à-dire dès qu'un ping sur l'IP virtuelle ne renvoie
rien. Ceci inclut la configuration correcte des routes sur le maître, et la mise à jour des tables ARP du réseau.

2) toutes les heures, recopier sa base de données, ses fichiers son et ses fichiers de configuration sur l'esclave.

3) toutes les 2 minutes, recopier la bdd astdb (utilisée par Asterisk) sur l'esclave. Ceci permet d'éviter que les
postes ne perdent leur enregistrement lors d'une bascule vers l'esclave.

4) lors du démarrage de ses interfaces réseau (suite à une coupure réseau par exemple, ou suite à un redémarrage de la
machine), récupérer la astdb de l'esclave si elle est plus récente que la astdb locale. Ceci permet d'éviter que les
postes ne perdent leur enregistrement lors de la rebascule de l'esclave vers le maître.

* Rôle de l'esclave *
---------------------

1) dès que le maître n'est plus fonctionnel, démarrer ses propres services XiVO et monter l'IP virtuelle
( + configuration des routes et mise à jour des tables ARP)

2) dès que le maître est à nouveau fonctionnel, arrêter ses services XiVO et tomber l'IP virtuelle

* Limitations *
---------------

1) Les modifications récentes effectuées sur le XiVO (datant de moins d'1 heure) seront perdues lors de la bascule. Ceci inclut les statuts d'agents, qui reviendront à ce qu'ils étaient lors de la dernière synchronisation.

2) Toute modification effectuée sur l'esclave ne sera pas répliquée sur le maître.
